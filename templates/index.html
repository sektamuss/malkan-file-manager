{% extends "layout.html" %}

{% block title %}Dosya Gezgini{% endblock %}

{% block styles %}
<style>
    .folder-icon {
        width: 1.2em;
        height: 1.2em;
        vertical-align: text-bottom;
        margin-right: 4px;
    }
</style>
{% endblock %}


{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-light rounded-pill px-3 py-2 mb-0">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Ana Dizin</a></li>
            {% for crumb in breadcrumbs %}
            <li class="breadcrumb-item"><a href="{{ url_for('index', path=crumb.path) }}">{{ crumb.name }}</a></li>
            {% endfor %}
        </ol>
    </nav>
    
    {% if current_user.is_authenticated and current_user.role == 'admin' %}
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#uploadModal">
            <i class="bi bi-upload"></i> <span class="d-none d-md-inline">Dosya Yükle</span>
        </button>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createFolderModal">
            <i class="bi bi-folder-plus"></i> <span class="d-none d-md-inline">Klasör Oluştur</span>
        </button>
    </div>
    {% endif %}
</div>

<div class="card">
    <div class="card-body">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th scope="col">İsim</th>
                    {% if current_user.is_authenticated and current_user.role == 'admin' %}
                    <th scope="col" class="text-end">İşlemler</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% if current_path != '.' %}
                <tr>
                    <td>
                        <a href="{{ url_for('index', path=current_path.rsplit('/', 1)[0] if '/' in current_path else '') }}" class="icon-link">
                            <i class="bi bi-arrow-90deg-up"></i> .. (Üst Dizin)
                        </a>
                    </td>
                    {% if current_user.is_authenticated and current_user.role == 'admin' %}<td></td>{% endif %}
                </tr>
                {% endif %}

                {% for item in items %}
                <tr>
                    <td>
                        {% if item.is_dir %}
                        <a href="{{ url_for('index', path=item.path) }}" class="icon-link">
                            {% if item.custom_icon_url %}
                                <img src="{{ item.custom_icon_url }}" class="folder-icon" alt="icon">
                            {% else %}
                                <i class="bi bi-folder-fill text-primary"></i>
                            {% endif %}
                            {{ item.name }}
                        </a>
                        {% else %}
                        <a href="{{ url_for('download_file', path=item.path) }}" class="icon-link" target="_blank">
                            <i class="bi bi-file-earmark-text"></i> {{ item.name }}
                        </a>
                        {% endif %}
                    </td>
                    {% if current_user.is_authenticated and current_user.role == 'admin' %}
                    <td class="text-end">
                         <div class="btn-group gap-2">
                             <button class="btn btn-sm btn-secondary" title="Kopyala" data-bs-toggle="modal" data-bs-target="#moveCopyModal" data-item-name="{{ item.name }}" data-item-path="{{ item.path }}" data-action="copy" data-is-dir="{{ item.is_dir|string|lower }}">
                                <i class="bi bi-subtract"></i><span class="d-none d-md-inline"> Kopyala</span>
                             </button>
                             <button class="btn btn-sm btn-info" title="Taşı" data-bs-toggle="modal" data-bs-target="#moveCopyModal" data-item-name="{{ item.name }}" data-item-path="{{ item.path }}" data-action="move" data-is-dir="{{ item.is_dir|string|lower }}">
                                <i class="bi bi-arrows-move"></i><span class="d-none d-md-inline"> Taşı</span>
                             </button>
                             <button class="btn btn-sm btn-warning" title="Yeniden Adlandır" data-bs-toggle="modal" data-bs-target="#renameModal" data-item-name="{{ item.name }}" data-item-path="{{ item.path }}">
                                 <i class="bi bi-pencil-fill"></i><span class="d-none d-md-inline"> Yeniden Adlandır</span>
                             </button>
                             <button class="btn btn-sm btn-danger" title="Sil" data-bs-toggle="modal" data-bs-target="#deleteModal" data-item-name="{{ item.name }}" data-item-path="{{ item.path }}">
                                 <i class="bi bi-trash-fill"></i><span class="d-none d-md-inline"> Sil</span>
                             </button>
                         </div>
                    </td>
                    {% endif %}
                </tr>
                {% else %}
                <tr>
                    <td colspan="2" class="text-center text-muted">Bu dizin boş.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if current_user.is_authenticated and current_user.role == 'admin' %}
{% endif %}
{% endblock %}

{% block scripts %}
{% endblock %}